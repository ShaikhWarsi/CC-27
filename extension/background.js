(()=>{chrome.runtime.onMessage.addListener((l,r,o)=>{if(l.action==="CAPTURE_SCREENSHOT")return console.log("[Sentinel Background] Capturing screenshot..."),chrome.tabs.captureVisibleTab(r.tab?.windowId,{format:"png",quality:80},e=>{chrome.runtime.lastError?(console.error("[Sentinel Background] Error capturing screenshot:",chrome.runtime.lastError),o({error:chrome.runtime.lastError.message})):(console.log("[Sentinel Background] Screenshot captured successfully."),o({screenshot:e}))}),!0;if(l.action==="KILL_SESSION"){if(console.log("[Sentinel Background] Killing session for tab:",r.tab?.url),r.tab&&r.tab.url)try{let c=new URL(r.tab.url).hostname;chrome.cookies.getAll({domain:c},n=>{n.forEach(t=>{let a=`${t.secure?"https:":"http:"}//${t.domain}${t.path}`;chrome.cookies.remove({url:a,name:t.name})}),console.log(`[Sentinel Background] Cleared ${n.length} cookies for ${c}`),o({success:!0,count:n.length})})}catch(e){console.error("[Sentinel Background] Error clearing cookies:",e),o({success:!1,error:String(e)})}else o({success:!1,error:"No URL found"});return!0}});chrome.runtime.onInstalled.addListener(()=>{console.log("Sentinel Layer (Fish-Pish) Installed.")});})();
